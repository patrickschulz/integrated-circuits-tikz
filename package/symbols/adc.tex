\tikzset{
    circuits/adc/width/.initial = 0.75cm,
    circuits/adc/height/.initial = 0.75cm,
    circuits/adc/trianglesize/.initial = 3pt,
    circuits/adc/angle/.initial = 45, % currently not used
    adc/.style = {adcshape, draw, wire}
}

\pgfdeclareshape{adcshape}
{
    \saveddimen{\width}{\pgf@x=\pgfkeysvalueof{/tikz/circuits/adc/width}}
    \saveddimen{\height}{\pgf@x=\pgfkeysvalueof{/tikz/circuits/adc/height}}
    \saveddimen{\trianglesize}{\pgf@x=\pgfkeysvalueof{/tikz/circuits/adc/trianglesize}}
    \savedanchor{\centerpoint}{\pgfpointorigin}
    \savedanchor{\outputport}{%
        \pgfpointadd%
        {\pgfpointorigin}%
        {\pgfpoint%
            {0.5 * \pgfkeysvalueof{/tikz/circuits/adc/width} + 0.25 * \pgfkeysvalueof{/tikz/circuits/adc/height}}%
            {0cm}
        }%
    }
    \savedanchor{\inputport}{%
        \pgfpointadd%
        {\pgfpointorigin}%
        {\pgfpoint%
            {-0.5 * \pgfkeysvalueof{/tikz/circuits/adc/width} - 0.25 * \pgfkeysvalueof{/tikz/circuits/adc/height}}%
            {0cm}
        }%
    }
    % electrical terminals (anchors)
    \anchor{in}{\pgfpointadd{\centerpoint}{\pgfpoint{-0.5 * \width - 0.25 * \height}{0cm}}}
    \anchor{out}{\outputport}
    \anchor{clk}{\pgfpointadd{\inputport}{\pgfpoint{0.5 * \height + 0.5 * \width}{-0.5 * \height}}}
    % regular anchors
    \anchor{center}{\centerpoint}
    \anchor{text} % this is used to center the text in the node
    {
        % the text node is shifted more than its width, a way of optical compensation (since the adc gets more narrow to the left)
        \pgfpoint{-0.4\wd\pgfnodeparttextbox}{-0.5\ht\pgfnodeparttextbox}
    }
    \anchor{north}{
        \pgfpointadd{\centerpoint}{\pgfpoint{0cm}{0.5 * \height}}
    }
    \anchor{south}{
        \pgfpointadd{\centerpoint}{\pgfpoint{0cm}{-0.5 * \height}}
    }
    \anchor{east}{
        \pgfpointadd{\centerpoint}{\pgfpoint{0.5 * \width + 0.25 * \height}{0cm}}
    }
    \anchor{west}{
        \pgfpointadd{\centerpoint}{\pgfpoint{-0.5 * \width - 0.25 * \height}{0cm}}
    }
    \anchor{north west}{
        \pgfpointadd{\centerpoint}{\pgfpoint{-0.5 * \width - 0.25 * \height}{0.5 * \height}}
    }
    \anchor{north east}{
        \pgfpointadd{\centerpoint}{\pgfpoint{0.5 * \width + 0.25 * \height}{0.5 * \height}}
    }
    \anchor{south west}{
        \pgfpointadd{\centerpoint}{\pgfpoint{-0.5 * \width - 0.25 * \height}{-0.5 * \height}}
    }
    \anchor{south east}{
        \pgfpointadd{\centerpoint}{\pgfpoint{0.5 * \width - 0.25 * \height}{-0.5 * \height}}
    }
    \backgroundpath{
        \pgfpathmoveto{\inputport}
        \pgfpathlineto{\pgfpointadd{\inputport}{\pgfpoint{0.5 * \height}{0.5 * \height}}}
        \pgfpathlineto{\pgfpointadd{\inputport}{\pgfpoint{0.5 * \height + \width}{0.5 * \height}}}
        \pgfpathlineto{\pgfpointadd{\inputport}{\pgfpoint{0.5 * \height + \width}{-0.5 * \height}}}
        \pgfpathlineto{\pgfpointadd{\inputport}{\pgfpoint{0.5 * \height}{-0.5 * \height}}}
        \pgfpathclose
    }
    \beforebackgroundpath{
        % draw clk triangle
        \pgfsetlinewidth{\pgfkeysvalueof{/tikz/circuits/line width}}
        \pgfpathmoveto{\pgfpointadd{\inputport}{\pgfpoint{0.5 * \height + 0.5 * \width - \trianglesize}{-0.5 * \height}}}
        \pgfpathlineto{\pgfpointadd{\inputport}{\pgfpoint{0.5 * \height + 0.5 * \width}{-0.5 * \height + \trianglesize}}}
        \pgfpathlineto{\pgfpointadd{\inputport}{\pgfpoint{0.5 * \height + 0.5 * \width + \trianglesize}{-0.5 * \height}}}
        \pgfusepath{stroke}
    }
}

% vim: ft=plaintex nowrap
